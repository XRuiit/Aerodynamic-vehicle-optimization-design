clc;clear;

%%CST参数化
x = linspace(0, 1, 60);
N1 = 0.5;
N2 = 1;
a_upper = [0.12, 0.14, 0.19, 0.16,0.2,0.2]; % 系数（3阶Bernstein多项式）
a_lower = [-0.12, -0.16, -0.19, -0.1,-0.15,0.1];
% a_upper = [0.1, 0.1, 0.1, 0.1,0.1,0.1]; % 系数（3阶Bernstein多项式）
% a_lower = [-0.1, -0.1, -0.1, -0.1,-0.1,0];

[z_upper, z_lower] = cst_airfoil(x, a_upper, a_lower, N1, N2);

%% RAE2822标准翼型数据
% 上翼面数据
x_upper = [0.000000, 0.000602, 0.002408, 0.005412, 0.009607, 0.014984, 0.021530, 0.029228, 0.038060, 0.048005, 0.059039, 0.071136, 0.084265, 0.098396, 0.113495, 0.129524, 0.146447, 0.164221, 0.182803, 0.202150, 0.222215, 0.242949, 0.264302, 0.286222, 0.308658, 0.331555, 0.354858, 0.378510, 0.402455, 0.426635, 0.450991, 0.475466, 0.500000, 0.524534, 0.549009, 0.573365, 0.597545, 0.621490, 0.645142, 0.668445, 0.691342, 0.713778, 0.735698, 0.757051, 0.777785, 0.797850, 0.817197, 0.835779, 0.853553, 0.870476, 0.886505, 0.901604, 0.915735, 0.928864, 0.940961, 0.951995, 0.961940, 0.970772, 0.978470, 0.985016, 0.990393, 0.994588, 0.997592, 0.999398, 1.000000];
y_upper = [0.000000, 0.003165, 0.006306, 0.009416, 0.012480, 0.015489, 0.018441, 0.021348, 0.024219, 0.027062, 0.029874, 0.032644, 0.035360, 0.038011, 0.040585, 0.043071, 0.045457, 0.047729, 0.049874, 0.051885, 0.053753, 0.055470, 0.057026, 0.058414, 0.059629, 0.060660, 0.061497, 0.062133, 0.062562, 0.062779, 0.062774, 0.062530, 0.062029, 0.061254, 0.060194, 0.058845, 0.057218, 0.055344, 0.053258, 0.050993, 0.048575, 0.046029, 0.043377, 0.040641, 0.037847, 0.035017, 0.032176, 0.029347, 0.026554, 0.023817, 0.021153, 0.018580, 0.016113, 0.013769, 0.011562, 0.009508, 0.007622, 0.005915, 0.004401, 0.003092, 0.002001, 0.001137, 0.000510, 0.000128, 0.000000];

% 下翼面数据
x_lower = [0.000000, 0.000602, 0.002408, 0.005412, 0.009607, 0.014984, 0.021530, 0.029228, 0.038060, 0.048005, 0.059039, 0.071136, 0.084265, 0.098396, 0.113495, 0.129524, 0.146447, 0.164221, 0.182803, 0.202150, 0.222215, 0.242949, 0.264302, 0.286222, 0.308658, 0.331555, 0.354858, 0.378510, 0.402455, 0.426635, 0.450991, 0.475466, 0.500000, 0.524534, 0.549009, 0.573365, 0.597545, 0.621490, 0.645142, 0.668445, 0.691342, 0.713778, 0.735698, 0.757051, 0.777785, 0.797850, 0.817197, 0.835779, 0.853553, 0.870476, 0.886505, 0.901604, 0.915735, 0.928864, 0.940961, 0.951995, 0.961940, 0.970772, 0.978470, 0.985016, 0.990393, 0.994588, 0.997592, 0.999398, 1.000000];
y_lower = [0.000000, -0.003160, -0.006308, -0.009443, -0.012559, -0.015649, -0.018707, -0.021722, -0.024685, -0.027586, -0.030416, -0.033170, -0.035843, -0.038431, -0.040929, -0.043326, -0.045610, -0.047773, -0.049805, -0.051694, -0.053427, -0.054994, -0.056376, -0.057547, -0.058459, -0.059046, -0.059236, -0.058974, -0.058224, -0.056979, -0.055257, -0.053099, -0.050563, -0.047719, -0.044642, -0.041397, -0.038043, -0.034631, -0.031207, -0.027814, -0.024495, -0.021289, -0.018232, -0.015357, -0.012690, -0.010244, -0.008027, -0.006048, -0.004314, -0.002829, -0.001592, -0.000600, 0.000157, 0.000694, 0.001033, 0.001197, 0.001212, 0.001112, 0.000935, 0.000719, 0.000497, 0.000296, 0.000137, 0.000035, 0.000000];

%% 绘制翼型
figure;
%2822
plot(x_upper, y_upper, 'r', 'LineWidth', 2); % 上翼面
hold on;
plot(x_lower, y_lower, 'r', 'LineWidth', 2); % 下翼面
legend();
%参数化翼型
plot(x, z_upper, 'b', 'LineWidth', 1.5, 'DisplayName', 'Upper Surface');
hold on;
plot(x, z_lower, 'b', 'LineWidth', 1.5, 'DisplayName', 'Lower Surface');

legend('2822上翼面','2822下翼面','参数化上翼面','参数化下翼面');
xlabel('Chord (x)');
ylabel('Thickness (z)');
title('CST Parameterized Airfoil');
axis equal;
grid on;
axis equal;






%% CST方法
function [z_upper, z_lower] = cst_airfoil(x, a_upper, a_lower, N1, N2, delta_te)
    % CST 方法生成翼型
    % 输入：
    %     x         : 弦长坐标 (0~1 的数组)
    %     a_upper   : 上表面 Bernstein 多项式系数 [a0, a1, ..., an]
    %     a_lower   : 下表面 Bernstein 多项式系数 [b0, b1, ..., bn]
    %     N1, N2    : 类别函数指数（默认圆头尖尾）
    %     delta_te  : 后缘厚度修正（默认0，自动闭合）
    % 返回：
    %     z_upper : 上表面z坐标
    %     z_lower : 下表面z坐标

    % 默认参数
    if nargin < 4 || isempty(N1)
        N1 = 0.5;
    end
    if nargin < 5 || isempty(N2)
        N2 = 1.0;
    end
    if nargin < 6 || isempty(delta_te)
        delta_te = 0.0;
    end

    % 类别函数
    C = x.^N1 .* (1 - x).^N2;

    % 计算形状函数 S(x)（Bernstein 多项式）
    n_upper = length(a_upper) - 1;
    S_upper = zeros(size(x));
    for i = 0:n_upper
        S_upper = S_upper + a_upper(i+1) * bernstein_poly(n_upper, i, x);
    end

    n_lower = length(a_lower) - 1;
    S_lower = zeros(size(x));
    for i = 0:n_lower
        S_lower = S_lower + a_lower(i+1) * bernstein_poly(n_lower, i, x);
    end

    % 计算上下表面坐标
    z_upper = C .* S_upper + x * delta_te;
    z_lower = C .* S_lower - x * delta_te; % 下表面符号调整

    % 后缘闭合修正（可选）
    z_upper(end) = (z_upper(end) + z_lower(end)) / 2;
    z_lower(end) = z_upper(end);

end

function B = bernstein_poly(n, i, x)
    % 计算 Bernstein 多项式
    coeff = nchoosek(n, i);
    B = coeff * x.^i .* (1 - x).^(n - i);
end

% 示例：生成对称翼型（类似 NACA0012）
